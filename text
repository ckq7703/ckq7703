from pymodbus.server.sync import StartTcpServer
from pymodbus.datastore import ModbusSlaveContext, ModbusServerContext
import logging

# Cấu hình logging
logging.basicConfig()
log = logging.getLogger()
log.setLevel(logging.INFO)

# Tạo Holding Registers (có thể là một danh sách rỗng hoặc với giá trị mặc định)
store = ModbusSlaveContext(hr=[0] * 100)  # 100 Holding Registers

# Tạo context Modbus
context = ModbusServerContext(slaves=store, single=True)

# Khởi động server Modbus
if __name__ == "__main__":
    print("Starting Modbus server...")
    StartTcpServer(context, address=("172.168.1.11", 502))









---------------------------------
from pymodbus.client.sync import ModbusTcpClient
import time

# Kết nối tới server
client = ModbusTcpClient('172.168.1.11', port=502)
client.connect()

# Ghi dữ liệu vào Holding Register
message = [1, 2, 3, 4, 5]  # Dữ liệu cần ghi
client.write_registers(0, message)

# Đọc dữ liệu từ Holding Register
result = client.read_holding_registers(0, 5)
print(f"Received data: {result.registers}")

# Đóng kết nối
client.close()
    client.close()
    log.info("Connection closed.")



